# Miner Setup Guide

## Before you proceed ⚠️

If you are new to Bittensor, we recommend familiarizing yourself with the basics in the [Bittensor Docs](https://docs.bittensor.com/) before proceeding.

**Run your own local subtensor** to avoid rate limits set on public endpoints. See [Run a Subtensor Node Locally](https://github.com/opentensor/subtensor/blob/main/docs/running-subtensor-locally.md#compiling-your-own-binary) for setup instructions.

**Understand your minimum compute requirements** for model training and miner deployment, which varies depending on your choice of model. You will likely need at least a consumer grade GPU for training. Many models can be deploying in CPU-only environments for mining. 


## Installation

Download the repository and navigate to the folder.
```bash
git clone https://github.com/bitmind-ai/bitmind-subnet.git && cd bitmind-subnet
```

We recommend using a Conda virtual environment to install the necessary Python packages.
- You can set up Conda with this [quick command-line install](https://docs.anaconda.com/free/miniconda/#quick-command-line-install). 
- Note that after you run the last commands in the miniconda setup process, you'll be prompted to start a new shell session to complete the initialization. 

With miniconda installed, you can create your virtual environment with this command:

```bash
conda create -y -n bitmind python=3.10
```

- Activating your virtual environment: `conda activate bitmind`
- Deactivating your virtual environment `conda deactivate`

Install the remaining necessary requirements with the following chained command. 
```bash
conda activate bitmind
export PIP_NO_CACHE_DIR=1
chmod +x setup.sh
./setup.sh
```

Before you register a miner on testnet or mainnet, you must first fill out all the necessary fields in `.env.miner`. Make a copy of the template, and fill in your wallet and axon information. 

```
cp .env.miner.template .env.miner
```

## Miner Types

SN34 supports two distinct miner types, each specializing in different tasks:

### DETECTOR Miners (Classification)
**Task**: Classify images and videos as real, synthetic, or semi-synthetic
- **Real**: Authentic media, not touched in any way by AI
- **Synthetic**: Fully AI-generated media  
- **Semisynthetic**: AI-modified (spatially, not temporally) media. E.g. faceswaps, inpainting, etc.

### SEGMENTER Miners (Segmentation)
**Task**: Identify AI-generated regions within images through pixel-level segmentation
- Receive images containing AI-generated regions
- Output confidence masks indicating which pixels are AI-generated
- Scored using Intersection over Union (IoU) metrics

**Configuration**: Set `MINER_TYPE=detector` or `MINER_TYPE=segmenter` in your `.env.miner` file.


## Miner Tasks

### DETECTOR Miner Outputs

> DETECTOR miners respond to validator queries with a probability vector [$p_{real}$, $p_{synthetic}$, $p_{semisynthetic}$]

Your task as a DETECTOR miner is to classify images and videos as real, synthetic, or semisynthetic.
- **Real**: Authentic meida, not touched in any way by AI
- **Synthetic**: Fully AI-generated media
- **Semisynthetic**: AI-modified (spatially, not temporally) media. E.g. faceswaps, inpainting, etc.

Minor details:
- You are scored only on correctness, so rounding these probabilities will not give you extra incentive.
- To maximize incentive, you must respond with the multiclass vector described above. 
  - If your classifier returns a binary response (e.g. a float in $[0., 1.]$ or a vector [$p_{real}$, $p_{synthetic}$]), you will earn partial credit (as defined by our incentive mechanism)

### SEGMENTER Miner Outputs

> SEGMENTER miners respond with confidence masks of shape `(H, W)` where each pixel value represents the likelihood that the pixel is AI-generated

Your task as a SEGMENTER miner is to identify AI-generated regions within images:

- **Input**: Images (typically semi-synthetic with AI modifications)
- **Output**: Continuous mask with values in `[0.0, 1.0]`
  - `0.0` = High confidence the pixel is real/original
  - `1.0` = High confidence the pixel is AI-generated
- **Scoring**: Intersection over Union (IoU) against ground truth masks

## Training Your Models

> [!IMPORTANT]
> The default detection and segmentation models provided in the miner templates serve only to exemplify the desired behavior of the miner neurons, and will not provide competitive performance on mainnet.

### DETECTOR Model Training

#### Model Recommendations
- **Architectures**: CNNs, Vision Transformers, etc.
- **Training data**: Datasets with real/synthetic/semi-synthetic labels
- **Loss functions**: Cross-entropy, focal loss

#### Data Sources
- Real: ImageNet, COCO, OpenImages
- Synthetic: Generated by DALL-E, Midjourney, Stable Diffusion
- Semi-synthetic: Faceswaps, inpainting, style transfer

### SEGMENTER Model Training

#### Model Recommendations
- **Architectures**: FCNs, Dense Prediction Transformers, Segmentation Transformers, etc.
- **Training data**: Datasets with AI-generated region masks
- **Loss functions**: Dice loss, BCE loss, or IoU loss

#### Data Sources
- Semi-synthetic images with masks indicating AI-generated/modified regions

## Registration

To run a miner, you must have a registered hotkey. 

> [!IMPORTANT]
> Registering on a Bittensor subnet burns TAO. To reduce the risk of deregistration due to technical issues or a poor performing model, we recommend the following:
> 1. Test your miner on testnet before you start mining on mainnet.
> 2. Before registering your hotkey on mainnet, make sure your axon port is accepting incoming traffic by running `curl your_ip:your_port`


#### Mainnet

```bash
btcli s register --netuid 34 --wallet.name [wallet_name] --wallet.hotkey [wallet.hotkey] --subtensor.network finney
```

#### Testnet

> For testnet tao, you can make requests in the [Bittensor Discord's "Requests for Testnet Tao" channel](https://discord.com/channels/799672011265015819/1190048018184011867)


```bash
btcli s register --netuid 168 --wallet.name [wallet_name] --wallet.hotkey [wallet.hotkey] --subtensor.network test
```

#### Mining

You can now launch your miner with `start_miner.sh`, which will use the configuration you provided in `.env.miner` (see the last step of the [Installation](#installation) section). 

The script automatically detects your `MINER_TYPE` and launches the appropriate miner:
- `MINER_TYPE=detector` → Launches detection miner
- `MINER_TYPE=segmenter` → Launches segmentation miner

```bash
./start_miner.sh
```

